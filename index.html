<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOKHAN OGUTMEN Emlak Asistanƒ± (v13)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #27ae60;
            --danger: #c0392b;
            --sold: #d63031;
            --tool-bg: #f8f9fa;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f3; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1800px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .backup-controls { display: flex; gap: 10px; }
        .btn-backup { background: #f39c12; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px; display: flex; align-items: center; gap: 5px; }
        .btn-upload { background: #16a085; }

        /* --- TOOLBAR (ARA√á √áUBUƒûU) --- */
        .tools-bar {
            display: flex;
            gap: 10px;
            background: var(--tool-bg);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 25px;
            border: 1px solid #ddd;
            flex-wrap: wrap;
            align-items: center;
        }
        .tool-btn {
            background: white;
            border: 1px solid #ccc;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            text-decoration: none; /* Linkler i√ßin */
        }
        .tool-btn:hover { background: var(--secondary); color: white; border-color: var(--secondary); }
        .tool-btn i { font-size: 16px; }
        .tkgm-btn { background: #e8f6f3; color: #16a085; border-color: #16a085; }
        .tkgm-btn:hover { background: #16a085; color: white; }
        /* DAKV Butonu √ñzel */
        .dakv-btn { background: #fef9e7; color: #d35400; border-color: #f39c12; }
        .dakv-btn:hover { background: #d35400; color: white; }

        /* Form */
        .input-panel { background: #fdfdfd; padding: 20px; border: 1px solid #ddd; border-left: 6px solid var(--primary); margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; }
        .form-group label { display: block; font-size: 11px; font-weight: 700; margin-bottom: 5px; color: #555; text-transform: uppercase; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        textarea.auto-expand { overflow-y: hidden; min-height: 40px; resize: none; transition: height 0.1s; }
        .auth-box { grid-column: span 2; display: flex; gap: 15px; background: #eafaf1; padding: 15px; border: 1px dashed var(--accent); border-radius: 6px; }
        .form-buttons { grid-column: span 2; display: flex; gap: 10px; margin-top: 10px; }
        .btn-save { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-weight: bold; flex: 2; }
        .btn-save:hover { background: #219150; }
        .btn-delete-rec { background: var(--danger); color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-weight: bold; flex: 1; display: none; }
        .btn-cancel { background: #7f8c8d; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; display: none; }

        /* Tablo */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; table-layout: fixed; }
        th { background: #34495e; color: white; padding: 12px; text-align: left; vertical-align: middle; }
        td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: middle; word-wrap: break-word; }
        tr:hover { background: #f9f9f9; }
        .badge { padding: 4px 8px; border-radius: 4px; color: white; font-size: 11px; font-weight: bold; display:inline-block; }
        .satilik { background: var(--secondary); } .kiralik { background: #e67e22; } .kirmizi-etiket { background: var(--sold) !important; }

        /* Link Stilleri */
        .direct-link-btn { display: inline-block; background-color: #3498db; color: white; text-decoration: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; font-weight: 600; }
        .direct-link-btn:hover { opacity: 0.9; }
        .link-sahibinden { background-color: #f1c40f; color: black; } .link-hepsi { background-color: #e74c3c; } .link-obudur { background-color: #8e44ad; } .link-emlakjet { background-color: #2ecc71; } .link-dosya { background-color: #95a5a6; border: 1px solid #7f8c8d; } .link-sosyal { background-color: #d63031; }

        /* Filtre */
        .filter-bar { background: var(--primary); padding: 15px; border-radius: 6px; display: flex; gap: 10px; flex-wrap: wrap; color: white; align-items: center; }
        .filter-bar input, .filter-bar select { padding: 8px; border: none; border-radius: 4px; color: #333; }

        /* Modal Generic */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; }
        .modal-content { background: white; margin: 5% auto; padding: 25px; width: 60%; border-radius: 8px; position: relative; max-height: 80vh; display: flex; flex-direction: column; }
        .modal-body { overflow-y: auto; margin-top: 15px; padding-right: 10px; }

        /* --- ARA√á MODALLARI STƒ∞LLERƒ∞ --- */
        .tool-modal-content { width: 450px; margin: 10% auto; }
        
        /* Hesap Makinesi */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calc-btn { padding: 15px; font-size: 18px; cursor: pointer; background: #eee; border: none; border-radius: 4px; }
        .calc-btn:hover { background: #ddd; }
        .calc-btn.op { background: var(--secondary); color: white; }
        .calc-btn.eq { background: var(--accent); color: white; grid-column: span 2; }
        .calc-screen { width: 100%; padding: 10px; font-size: 24px; text-align: right; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        
        /* D√∂viz Ekranƒ± */
        .currency-board { display: flex; flex-direction: column; gap: 15px; }
        .currency-row { display: flex; align-items: center; justify-content: space-between; background: #f9f9f9; padding: 10px; border-radius: 6px; border: 1px solid #eee; }
        .curr-flag { font-size: 24px; margin-right: 10px; }
        .curr-name { font-weight: bold; font-size: 16px; color: #555; flex: 1; }
        .curr-input { width: 100px; padding: 8px; font-weight: bold; text-align: right; border: 1px solid #ccc; border-radius: 4px; font-size: 15px; color: #333; }
        .curr-label { font-size: 10px; color: #777; margin-bottom: 2px; text-align: right; }
        .currency-result { background: #eafaf1; border: 1px solid #27ae60; padding: 15px; text-align: center; border-radius: 6px; margin-top: 10px; }
        
        .tab-buttons { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: none; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab-btn.active { border-bottom-color: var(--secondary); color: var(--secondary); font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .result-box { margin-top: 15px; padding: 10px; background: #f0f9ff; border: 1px solid #bce8f1; color: #31708f; font-weight: bold; border-radius: 4px; text-align: center; font-size: 1.1em; }

        /* Print */
        .print-only { display: none; }
        @media print { 
            .input-panel, .filter-bar, .backup-controls, .tools-bar { display: none !important; } 
            .no-print { display: none !important; }
            .print-only { display: table-cell !important; }
            body { background: white; padding: 0; margin: 0; }
            .container { box-shadow: none; border: none; width: 100%; max-width: 100%; padding: 0; }
            table { width: 100%; font-size: 10px; }
            th, td { border: 1px solid #ddd; padding: 4px; color: black; }
            th { background-color: #eee !important; color: black !important; font-weight: bold; }
            th:nth-child(1) { width: 8%; } th:nth-child(2) { width: 13%; } th:nth-child(3) { width: 8%; } th:nth-child(4) { width: 10%; }
            th:nth-child(5) { width: 9%; } th:nth-child(6) { width: 14%; } th:nth-child(7) { width: 9%; } th.print-only { width: 29%; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>üè¢ KARACABAYRE.EST <span style="font-size:12px; color:#27ae60; border:1px solid #27ae60; padding:2px 8px; border-radius:10px;">HDD KAYIT AKTƒ∞F</span></h1>
        </div>
        <div class="backup-controls">
            <input type="file" id="fileUpload" style="display:none;" onchange="uploadData(this)">
            <button class="btn-backup btn-upload" onclick="document.getElementById('fileUpload').click()">üìÇ YEDEK Y√úKLE</button>
            <button class="btn-backup" onclick="downloadData()">üíæ YEDEKLE</button>
        </div>
    </header>

    <div class="tools-bar">
        <button class="tool-btn" onclick="openModal('calcModal')"><i class="fa-solid fa-calculator"></i> Hesap Makinesi</button>
        <button class="tool-btn" onclick="openModal('currencyModal'); fetchCurrency();"><i class="fa-solid fa-money-bill-transfer"></i> D√∂viz √áevirici (TCMB)</button>
        <button class="tool-btn" onclick="openModal('realEstateCalcModal')"><i class="fa-solid fa-file-contract"></i> Hesaplamalar</button>
        
        <a href="https://www.hesapkurdu.com/konut-kredisi/h/gayrimenkul-deger-artis-kazanci-vergisi-hesaplama?keyword=&adtextid=&utm_source=google&utm_medium=cpc&utm_campaign=performance_max_-_conversion&utm_adgroup=&utm_content=x&gad_source=1&gad_campaignid=21683109554&gbraid=0AAAAADpnQnaJFwTsM3iG0oiKQ9AidH4Za&gclid=Cj0KCQiApfjKBhC0ARIsAMiR_IvemuDEVo2Ybna0usezvpRJIHc155FOiM8azbY0q24HMJ1N-AqAmwEaApxoEALw_wcB" target="_blank" class="tool-btn dakv-btn"><i class="fa-solid fa-calculator"></i> DAKV Hesapla</a>
        
        <a href="https://parselsorgu.tkgm.gov.tr/" target="_blank" class="tool-btn tkgm-btn"><i class="fa-solid fa-map-location-dot"></i> TKGM Parsel Sorgu</a>
    </div>

    <div class="input-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <span id="formTitle" style="font-weight:bold; color:var(--primary); font-size:1.1em;">‚ûï Yeni Portf√∂y Ekle</span>
            <button id="btnCancel" class="btn-cancel" onclick="resetForm()">TEMƒ∞ZLE / ƒ∞PTAL</button>
        </div>
        
        <div class="form-grid">
            <div class="form-group"><label>Menkul Cinsi</label><select id="inpType"><option>Daire</option><option>Villa</option><option>Arsa</option><option>ƒ∞≈üyeri</option><option>Tarla</option><option>Proje</option></select></div>
            <div class="form-group"><label>ƒ∞≈ülem T√ºr√º</label><select id="inpStatus"><option>Satƒ±lƒ±k</option><option>Kiralƒ±k</option><option>Devren</option><option style="color:red; font-weight:bold;">Satƒ±ldƒ±</option><option style="color:red; font-weight:bold;">Kiralandƒ±</option></select></div>
            <div class="form-group"><label>ƒ∞l√ße</label><select id="inpDistrict" onchange="loadMahalleler('inpDistrict', 'dl_mahalle_ekle')"><option value="">Se√ßiniz</option></select></div>
            <div class="form-group"><label>Mahalle</label><input type="text" list="dl_mahalle_ekle" id="inpNeighborhood" placeholder="Yazƒ±nƒ±z..." autocomplete="off"><datalist id="dl_mahalle_ekle"></datalist></div>
            <div class="form-group"><label>Oda</label><select id="inpRooms"></select></div>
            <div class="form-group"><label>Kat</label><select id="inpFloor"></select></div>
            <div class="form-group"><label>Br√ºt m¬≤</label><input type="number" id="inpGross" placeholder="m¬≤"></div>
            <div class="form-group"><label>Net m¬≤</label><input type="number" id="inpNet" placeholder="m¬≤"></div>
            <div class="form-group"><label>Fiyat (TL)</label><input type="text" id="inpPrice" placeholder="5.000.000" oninput="formatCurrency(this)"></div>
            <div class="auth-box">
                <div class="form-group" style="flex:1;"><label>Yetki Ba≈ülangƒ±√ß</label><input type="date" id="inpAuthStart"></div>
                <div class="form-group" style="flex:1;"><label>Yetki Biti≈ü</label><input type="date" id="inpAuthEnd"></div>
            </div>
            <div class="form-group"><label>M√º≈üteri Ad Soyad</label><input type="text" id="inpRef"></div>
            <div class="form-group"><label>M√º≈üteri Telefon</label><input type="text" id="inpPhone" placeholder="05XX..." maxlength="17" oninput="formatPhone(this)"></div>
            <div class="form-group"><label>Dosya / Link</label><textarea id="inpLink" placeholder="Link veya Dosya Yolu..." rows="1" class="auto-expand" oninput="autoResize(this)"></textarea></div>
            <div class="form-group" style="grid-column:span 2;"><label>A√ßƒ±klama</label><textarea id="inpDesc" class="auto-expand" placeholder="Detaylƒ± a√ßƒ±klama..." oninput="autoResize(this)"></textarea></div>
            <div class="form-buttons">
                <button id="btnSave" class="btn-save" onclick="handleSave()">KAYDET</button>
                <button id="btnDelete" class="btn-delete-rec" onclick="deleteFromForm()">üóëÔ∏è Sƒ∞L</button>
            </div>
        </div>
    </div>

    <div class="filter-bar">
        <span>üîç ARA:</span>
        <input type="text" id="searchBox" placeholder="ƒ∞sim, Tel, Not..." onkeyup="renderTable()" style="width:140px;">
        <select id="filterStatus" onchange="renderTable()" style="width:110px;"><option value="all">T√ºm Durumlar</option><option>Satƒ±lƒ±k</option><option>Kiralƒ±k</option><option>Devren</option><option style="color:red;">Satƒ±ldƒ±</option><option style="color:red;">Kiralandƒ±</option></select>
        <select id="filterRooms" onchange="renderTable()" style="width:120px;"><option value="all">T√ºm Odalar</option></select>
        <select id="filterDistrict" onchange="loadMahalleler('filterDistrict', 'dl_mahalle_filtre')"><option value="all">T√ºm ƒ∞l√ßeler</option></select>
        <input type="text" list="dl_mahalle_filtre" id="filterNeighborhood" placeholder="Mahalle Ara..." onkeyup="renderTable()" style="width:120px;" autocomplete="off"><datalist id="dl_mahalle_filtre"></datalist>
        <input type="number" id="filterMinPrice" placeholder="Min TL" onkeyup="renderTable()" style="width:80px;">
        <input type="number" id="filterMaxPrice" placeholder="Max TL" onkeyup="renderTable()" style="width:80px;">
        <button onclick="window.print()" style="margin-left:auto; background:#8e44ad; border:none; color:white; padding:8px 15px; border-radius:4px; cursor:pointer;">üñ®Ô∏è YAZDIR</button>
    </div>

    <table id="portfolioTable">
        <thead>
            <tr>
                <th width="8%">Cins/T√ºr</th> <th width="12%">Lokasyon</th> <th width="8%">√ñzellikler</th> <th width="10%">m¬≤ (Br√ºt/Net)</th> 
                <th width="9%">Fiyat</th> <th width="14%">M√º≈üteri / Tel</th> <th width="9%">Yetki</th>
                <th class="no-print" width="6%" style="text-align:center;">Linkler</th> <th class="no-print" width="5%" style="text-align:center;">Not</th> <th class="no-print" width="8%">ƒ∞≈ülem</th>
                <th class="print-only">A√ßƒ±klama / Notlar</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<div id="descModal" class="modal" onclick="closeModalOutside(event, 'descModal')"><div class="modal-content"><div style="display:flex;justify-content:space-between;"><h3>üìù Detaylƒ± Notlar</h3><span onclick="closeModal('descModal')" style="cursor:pointer;font-size:24px;">&times;</span></div><div class="modal-body"><p id="modalText" style="white-space: pre-wrap; margin:0; line-height: 1.6;"></p></div></div></div>

<div id="calcModal" class="modal" onclick="closeModalOutside(event, 'calcModal')">
    <div class="modal-content tool-modal-content">
        <div style="display:flex;justify-content:space-between; margin-bottom:10px;"><h3>üßÆ Hesap Makinesi</h3><span onclick="closeModal('calcModal')" style="cursor:pointer;font-size:24px;">&times;</span></div>
        <input type="text" id="calcDisplay" class="calc-screen" readonly>
        <div class="calc-grid">
            <button class="calc-btn" onclick="calcInput('7')">7</button><button class="calc-btn" onclick="calcInput('8')">8</button><button class="calc-btn" onclick="calcInput('9')">9</button><button class="calc-btn op" onclick="calcInput('/')">√∑</button>
            <button class="calc-btn" onclick="calcInput('4')">4</button><button class="calc-btn" onclick="calcInput('5')">5</button><button class="calc-btn" onclick="calcInput('6')">6</button><button class="calc-btn op" onclick="calcInput('*')">√ó</button>
            <button class="calc-btn" onclick="calcInput('1')">1</button><button class="calc-btn" onclick="calcInput('2')">2</button><button class="calc-btn" onclick="calcInput('3')">3</button><button class="calc-btn op" onclick="calcInput('-')">-</button>
            <button class="calc-btn" onclick="calcInput('0')">0</button><button class="calc-btn" onclick="calcInput('.')">.</button><button class="calc-btn" onclick="calcClear()">C</button><button class="calc-btn op" onclick="calcInput('+')">+</button>
            <button class="calc-btn eq" onclick="calcResult()">=</button>
        </div>
    </div>
</div>

<div id="currencyModal" class="modal" onclick="closeModalOutside(event, 'currencyModal')">
    <div class="modal-content tool-modal-content">
        <div style="display:flex;justify-content:space-between; margin-bottom:15px;">
            <h3>üí± D√∂viz (Efektif Satƒ±≈ü)</h3>
            <span onclick="closeModal('currencyModal')" style="cursor:pointer;font-size:24px;">&times;</span>
        </div>
        
        <div style="margin-bottom:15px;">
            <a href="https://www.tcmb.gov.tr/wps/wcm/connect/tr/tcmb+tr/main+page+site+area/bugun" target="_blank" class="tool-btn tkgm-btn" style="width:100%; justify-content:center; text-align:center;">
                <i class="fa-solid fa-building-columns"></i> TCMB Kurlarƒ±nƒ± A√ß (Kontrol Et)
            </a>
            <div style="font-size:11px; color:#666; margin-top:5px; text-align:center;">*Otomatik deƒüerler piyasa verisidir. Kesin i≈ülem i√ßin TCMB sayfasƒ±ndaki "Efektif Satƒ±≈ü" s√ºtununa bakƒ±p kutucuƒüu g√ºncelleyiniz.</div>
        </div>

        <div class="currency-board">
            <div class="currency-row">
                <span class="curr-flag">üá∫üá∏</span>
                <span class="curr-name">USD / TRY</span>
                <div>
                    <div class="curr-label">Efektif Satƒ±≈ü</div>
                    <input type="number" id="usdRate" class="curr-input" placeholder="36.00">
                </div>
            </div>

            <div class="currency-row">
                <span class="curr-flag">üá™üá∫</span>
                <span class="curr-name">EUR / TRY</span>
                <div>
                    <div class="curr-label">Efektif Satƒ±≈ü</div>
                    <input type="number" id="eurRate" class="curr-input" placeholder="38.00">
                </div>
            </div>
        </div>

        <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">

        <div class="form-group">
            <label>√áevrilecek Tutar (D√∂viz)</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="calcCurrAmount" placeholder="√ñrn: 1000" style="flex:2;">
                <select id="calcCurrType" style="flex:1;">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
            </div>
        </div>

        <button class="btn-save" style="width:100%; margin-top:10px;" onclick="calculateCurrencyTotal()">HESAPLA (TL)</button>
        <div id="currencyTotalRes" class="currency-result" style="display:none;">
            <span id="currResText" style="font-size:1.4em; font-weight:bold; color:#2c3e50;">0,00 TL</span>
        </div>
    </div>
</div>

<div id="realEstateCalcModal" class="modal" onclick="closeModalOutside(event, 'realEstateCalcModal')">
    <div class="modal-content" style="width:500px;">
        <div style="display:flex;justify-content:space-between; margin-bottom:10px;"><h3>üßæ Emlak Hesaplamalarƒ±</h3><span onclick="closeModal('realEstateCalcModal')" style="cursor:pointer;font-size:24px;">&times;</span></div>
        
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('tabTapu')">Tapu & Komisyon</button>
            <button class="tab-btn" onclick="switchTab('tabEmsal')">Emsal</button>
            <button class="tab-btn" onclick="switchTab('tabVergi')">Emlak Vergisi</button>
        </div>

        <div id="tabTapu" class="tab-content active">
            <div class="form-group"><label>Satƒ±≈ü Bedeli (TL)</label><input type="number" id="calcPrice" placeholder="√ñrn: 5000000"></div>
            <button class="btn-save" style="width:100%; margin-top:10px;" onclick="calcTapuKomisyon()">HESAPLA</button>
            <div id="resTapu" class="result-box" style="display:none; text-align:left; font-size:13px;"></div>
        </div>

        <div id="tabEmsal" class="tab-content">
            <div class="form-group"><label>Arsa Alanƒ± (m¬≤)</label><input type="number" id="calcArsaM2"></div>
            <div class="form-group"><label>KAKS / Emsal Oranƒ±</label><input type="number" id="calcKaks" placeholder="√ñrn: 1.5"></div>
            <button class="btn-save" style="width:100%; margin-top:10px;" onclick="calcEmsal()">HESAPLA</button>
            <div id="resEmsal" class="result-box" style="display:none;"></div>
        </div>

        <div id="tabVergi" class="tab-content">
            <div class="form-group"><label>Emlak Vergisi Hesapla</label></div>
            <div style="display:flex; gap:10px;">
                <select id="calcVergiType" style="flex:1;"><option value="0.002">Konut (B.≈ûehir - %0.2)</option><option value="0.001">Konut (Normal - %0.1)</option><option value="0.004">ƒ∞≈üyeri (B.≈ûehir - %0.4)</option><option value="0.002">ƒ∞≈üyeri (Normal - %0.2)</option><option value="0.006">Arsa (B.≈ûehir - %0.6)</option></select>
                <input type="number" id="calcVergiDeger" placeholder="Rayi√ß Bedel" style="flex:1;">
            </div>
            <button class="btn-save" style="width:100%; margin-top:5px;" onclick="calcEmlakVergisi()">VERGƒ∞ HESAPLA</button>
            <div id="resVergi" class="result-box" style="display:none; margin-bottom:15px;"></div>
        </div>
    </div>
</div>

<script>
    // --- VERƒ∞TABANI & AYARLAR ---
    const antalyaData = {
        "Akseki": ["Merkez", "Bademli", "Cevizli", "G√º√ßl√ºk√∂y", "Kuyucak", "S√ºleymaniye", "Yarpuz"],
        "Aksu": ["Altƒ±nta≈ü", "Atat√ºrk", "Barbaros", "Boztepe", "Cihadiye", "√áalkaya", "√áamk√∂y", "Dumanlar", "Fatih", "G√∂kdere", "G√ºloluk", "G√ºzelyurt", "Hacƒ±aliler", "Kara√ßallƒ±", "Kemeraƒüzƒ±", "Konak", "Kundu", "Macun", "Mandƒ±rlar", "Murtuna", "Pƒ±narlƒ±", "Soƒüucaksu", "Solak", "Yurtpƒ±nar"],
        "Alanya": ["Merkez", "Avsallar", "Cikcilli", "√áƒ±plaklƒ±", "Demirta≈ü", "G√ºller Pƒ±narƒ±", "Hacet", "ƒ∞ncekum", "Kargƒ±cak", "Kestel", "Konaklƒ±", "K√º√ß√ºkhasbah√ße", "Mahmutlar", "Oba", "Okurcalar", "Payallar", "Saray", "≈ûekerhane", "Tosmur", "T√ºrkler", "Yaylalƒ±"],
        "Demre": ["Merkez", "Beymelek", "Karabucak", "Kekova", "Yavu"],
        "D√∂≈üemealtƒ±": ["Altƒ±nkale", "Ayanlar", "Aydƒ±nlar", "Bah√ßeyaka", "Bƒ±yƒ±klƒ±", "Camili", "√áƒ±ƒülƒ±k", "√áƒ±plaklƒ±", "Daƒübeli", "D√ºzler√ßamƒ±", "Ek≈üili", "Ilƒ±ca", "Karaman", "Karata≈ü", "Kovanlƒ±k", "K√∂m√ºrc√ºler", "Nebiler", "Tomalar", "Yalƒ±nlƒ±", "Yenik√∂y", "Ye≈üilbayƒ±r"],
        "Elmalƒ±": ["Merkez", "Karyaƒüdƒ±", "G√ºndoƒüan", "ƒ∞plik Pazarƒ±", "Toklular"],
        "Finike": ["Merkez", "Eski", "Hasyurt", "ƒ∞skele", "Kale", "Kar≈üƒ±yaka", "Kum", "Sahilkent", "Turun√ßova", "Yeni", "Ye≈üilyurt"],
        "Gazipa≈üa": ["Merkez", "Pazarcƒ±", "Gazi", "ƒ∞stiklal", "Cumhuriyet", "Koru", "Bakƒ±lar", "Ekmel"],
        "G√ºndoƒümu≈ü": ["Merkez", "Fatih", "Rasih Kaplan"],
        "ƒ∞bradƒ±": ["Merkez", "A≈üaƒüƒ±", "Yukarƒ±", "Ormana"],
        "Ka≈ü": ["Merkez", "Andifli", "G√∂mbe", "Kalkan", "Kƒ±nƒ±k", "Ova", "Ye≈üilk√∂y", "Gelemi≈ü", "ƒ∞slamlar", "Patara"],
        "Kemer": ["Merkez", "Arslanbucak", "Beldibi", "Beycik", "√áamyuva", "G√∂yn√ºk", "Kiri≈ü", "Kuzdere", "Tekirova", "Ulupƒ±nar", "Yeni"],
        "Kepez": ["Ahatlƒ±", "Altƒ±nova", "Atat√ºrk", "Avni Tolunay", "Ayanoƒülu", "Baraj", "Barƒ±≈ü", "Ba≈ük√∂y", "Be≈ükonak", "√áamlƒ±bel", "√áankaya", "Demirel", "Duacƒ±", "Duraliler", "D√ºdenba≈üƒ±", "Emek", "Erenk√∂y", "Esentepe", "Fabrikalar", "Fatih", "Fevzi √áakmak", "Gazi", "G√∂ksu", "G√ºlveren", "G√ºndoƒüdu", "G√ºne≈ü", "Habibler", "H√ºsn√º Karaka≈ü", "Kanal", "Kar≈üƒ±yaka", "Kazƒ±m Karabekir", "Kepez", "Kuzeyyaka", "K√ºlt√ºr", "Mehmet Akif", "Menderes", "√ñzg√ºrl√ºk", "Santral", "S√ºt√ß√ºler", "≈ûafak", "Teomanpa≈üa", "Ulus", "√únsal", "Varsak", "Yavuz Selim", "Yeni", "Yeni Doƒüan", "Ye≈üiltepe", "Ye≈üilyurt", "Y√ºkseli≈ü", "Zafer", "Zeytinlik"],
        "Konyaaltƒ±": ["Akdamlar", "Akkuyu", "Altƒ±nkum", "Arapsuyu", "A≈üaƒüƒ±karaman", "Bahtƒ±lƒ±", "√áaƒülarca", "√áakƒ±rlar", "Doyran", "Geyikbayƒ±rƒ±", "G√∂k√ßam", "G√ºrsu", "Hacƒ±sekililer", "Hisar√ßandƒ±r", "Hurma", "Karatepe", "Kƒ±r", "Ku≈ükavaƒüƒ±", "Liman", "Molla Yusuf", "√ñƒüretmenevleri", "Pƒ±narba≈üƒ±", "Sarƒ±su", "Siteler", "Toros", "Ulu√ß", "Uncalƒ±", "Yarba≈ü√ßandƒ±r", "Z√ºmr√ºt"],
        "Korkuteli": ["Merkez", "Alaaddin", "A≈üaƒüƒ±pazar", "Kiremitli", "Uzunoluk", "Yeni", "Datk√∂y"],
        "Kumluca": ["Merkez", "Baƒülƒ±k", "Beykonak", "Cumhuriyet", "Eskicami", "G√∂ksu", "Kar≈üƒ±yaka", "Kasap√ßayƒ±rƒ±", "Mavikent", "Meydan", "Narenciye", "Sarƒ±casu", "Temel Eƒüitim", "Yeni"],
        "Manavgat": ["Merkez", "A≈üaƒüƒ± Pazarcƒ±", "A≈üaƒüƒ± Hisar", "Bah√ßelievler", "√áaƒülayan", "√áolaklƒ±", "Emek", "Eski Hisar", "Evrenseki", "G√ºndoƒüdu", "Ilƒ±ca", "Kasaplar", "Kavaklƒ±", "Kƒ±zƒ±laƒüa√ß", "Kƒ±zƒ±lot", "Milli Egemenlik", "Mimarsinan", "√ñrnek", "Salkƒ±m Evler", "Sarƒ±lar", "Side", "Sorgun", "≈ûelale", "Ta≈üaƒüƒ±l", "Ulukapƒ±", "Yukarƒ± Hisar", "Yukarƒ± Pazarcƒ±"],
        "Muratpa≈üa": ["Altƒ±ndaƒü", "Bah√ßelievler", "Balbey", "Barbaros", "Bayƒ±ndƒ±r", "Cumhuriyet", "√áaƒülayan", "√áayba≈üƒ±", "Demircikara", "Deniz", "Doƒüuyaka", "Dutlubah√ße", "Elmalƒ±", "Ermenek", "Etiler", "Fener", "Gebizli", "Gen√ßlik", "G√ºvenlik", "G√ºzelbaƒü", "G√ºzeloba", "G√ºzeloluk", "Ha≈üimi≈ücan", "Kƒ±≈üla", "Kƒ±rcami", "Kƒ±zƒ±ltoprak", "Kƒ±zƒ±lsaray", "Konuksever", "Mehmet√ßik", "Meltem", "Memurevleri", "Meydankavaƒüƒ±", "Muratpa≈üa", "Sedir", "Sel√ßuk", "Sinan", "Soƒüuksu", "≈ûirinyalƒ±", "Tahƒ±lpazarƒ±", "Tarƒ±m", "Top√ßular", "Tuzcular", "√ú√ßgen", "Varlƒ±k", "Yenig√ºn", "Ye≈üilbah√ße", "Ye≈üildere", "Ye≈üilova", "Yƒ±ldƒ±z", "Y√ºksekalan", "Zerdalilik", "Z√ºmr√ºtova"],
        "Serik": ["Merkez", "Ak√ßaalan", "Belek", "Belkƒ±s", "Boƒüazkent", "Cumalƒ±", "√áandƒ±r", "Gedik", "Kadriye", "Karadayƒ±", "K√∂kez", "K√ºr√º≈ü", "Merkez", "Orta", "Yeni", "Yukarƒ± Kocayatak"]
    };

    const floorList = ["Se√ßiniz...", "Giri≈ü Altƒ± Kot 4", "Giri≈ü Altƒ± Kot 3", "Giri≈ü Altƒ± Kot 2", "Giri≈ü Altƒ± Kot 1", "Bodrum", "Zemin", "Bah√ße Katƒ±", "Giri≈ü", "Y√ºksek Giri≈ü", "M√ºstakil", "Dubleks", "Tripleks", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30 ve √ºzeri"];
    const roomList = ["Se√ßiniz...", "St√ºdyo (1+0)", "1+1", "1.5+1", "2+0", "2+1", "2.5+1", "3+0", "3+1", "3.5+1", "4+0", "4+1", "4+2", "4+3", "4+4", "5+1", "5.5+1", "5+2", "6+1", "6+2", "7+1", "Villa", "Komple Bina"];

    let portfolio = JSON.parse(localStorage.getItem('KaracabayRE_EST_DB_v13')) || [];
    let editingId = null;

    window.onload = function() { populateSelects(); renderTable(); };

    // --- TEMEL FONKSƒ∞YONLAR ---
    function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
    function formatPhone(input) {
        let n = input.value.replace(/\D/g, ''); if(n.length===0){input.value='';return;}
        if(n[0]!=='0') n='0'+n; n=n.substring(0,11);
        let f = ''; if(n.length>0)f+=n.substring(0,1); if(n.length>1)f+=' ('+n.substring(1,4); if(n.length>4)f+=') '+n.substring(4,7); if(n.length>7)f+=' '+n.substring(7,9); if(n.length>9)f+=' '+n.substring(9,11);
        input.value = f;
    }
    function formatCurrency(input) { let v=input.value.replace(/\D/g, ''); input.value=v.replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
    function parsePrice(v) { return v ? parseInt(v.toString().replace(/\./g,'')) : 0; }

    // --- MODAL Y√ñNETƒ∞Mƒ∞ ---
    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function closeModalOutside(e, id) { if(e.target == document.getElementById(id)) closeModal(id); }

    // --- HESAP MAKƒ∞NESƒ∞ ---
    let calcExp = "";
    function calcInput(v) { calcExp += v; document.getElementById('calcDisplay').value = calcExp; }
    function calcClear() { calcExp = ""; document.getElementById('calcDisplay').value = ""; }
    function calcResult() { try { calcExp = eval(calcExp).toString(); document.getElementById('calcDisplay').value = calcExp; } catch(e) { document.getElementById('calcDisplay').value = "Hata"; calcExp=""; } }

    // --- D√ñVƒ∞Z (TCMB Entegrasyonu) ---
    async function fetchCurrency() {
        // Otomatik veri √ßekme (Piyasa verisi - Yakla≈üƒ±k deƒüer)
        // TCMB'den direkt √ßekmek CORS hatasƒ± verdiƒüi i√ßin free API kullanƒ±yoruz.
        try {
            const res = await fetch('https://api.exchangerate-api.com/v4/latest/TRY');
            const data = await res.json();
            // API 1 TRY = X USD verir, tersini alƒ±yoruz (1 USD = ? TRY)
            let usd = (1 / data.rates.USD).toFixed(4);
            let eur = (1 / data.rates.EUR).toFixed(4);
            
            // Eƒüer kutular bo≈üsa doldur, doluysa (kullanƒ±cƒ± d√ºzeltmi≈üse) elleme
            if(document.getElementById('usdRate').value === "") document.getElementById('usdRate').value = usd;
            if(document.getElementById('eurRate').value === "") document.getElementById('eurRate').value = eur;
        } catch(e) {
            console.log("Kur verisi √ßekilemedi.");
        }
    }

    function calculateCurrencyTotal() {
        let amount = parseFloat(document.getElementById('calcCurrAmount').value);
        let type = document.getElementById('calcCurrType').value;
        let rate = 0;
        
        if(type === 'USD') rate = parseFloat(document.getElementById('usdRate').value);
        else rate = parseFloat(document.getElementById('eurRate').value);

        if(!amount || !rate) return;
        
        let total = amount * rate;
        document.getElementById('currResText').innerText = total.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " TL";
        document.getElementById('currencyTotalRes').style.display = 'block';
    }

    // --- EMLAK HESAPLARI ---
    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(d => d.style.display='none');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).style.display = 'block';
        event.currentTarget.classList.add('active');
    }

    function calcTapuKomisyon() {
        let p = parseFloat(document.getElementById('calcPrice').value);
        if(!p) return;
        let tapu = p * 0.04;
        let kom = p * 0.02 * 1.20;
        
        let html = `
            <strong>Tapu Harcƒ± (Toplam %4):</strong> ${tapu.toLocaleString()} TL<br>
            <small>(Alƒ±cƒ±: ${(tapu/2).toLocaleString()} TL - Satƒ±cƒ±: ${(tapu/2).toLocaleString()} TL)</small><br><br>
            <strong>Hizmet Bedeli (Tek Taraf %2+KDV):</strong> ${kom.toLocaleString()} TL<br>
            <small>(Net: ${(p*0.02).toLocaleString()} TL + KDV: ${(p*0.02*0.2).toLocaleString()} TL)</small>
        `;
        document.getElementById('resTapu').innerHTML = html;
        document.getElementById('resTapu').style.display = 'block';
    }

    function calcEmsal() {
        let m2 = parseFloat(document.getElementById('calcArsaM2').value);
        let kaks = parseFloat(document.getElementById('calcKaks').value);
        if(!m2 || !kaks) return;
        let insaat = m2 * kaks;
        document.getElementById('resEmsal').innerHTML = `Toplam ƒ∞n≈üaat Alanƒ±: <strong>${insaat.toLocaleString()} m¬≤</strong>`;
        document.getElementById('resEmsal').style.display = 'block';
    }

    function calcEmlakVergisi() {
        let val = parseFloat(document.getElementById('calcVergiDeger').value);
        let rate = parseFloat(document.getElementById('calcVergiType').value);
        if(!val) return;
        let tax = val * rate;
        document.getElementById('resVergi').innerHTML = `Yƒ±llƒ±k Vergi: <strong>${tax.toLocaleString()} TL</strong>`;
        document.getElementById('resVergi').style.display = 'block';
    }

    // --- CRUD ---
    function handleSave() {
        const data = {
            id: editingId ? editingId : Date.now(),
            type: document.getElementById('inpType').value,
            status: document.getElementById('inpStatus').value,
            district: document.getElementById('inpDistrict').value,
            neighborhood: document.getElementById('inpNeighborhood').value,
            rooms: document.getElementById('inpRooms').value,
            floor: document.getElementById('inpFloor').value,
            gross: document.getElementById('inpGross').value,
            net: document.getElementById('inpNet').value,
            price: document.getElementById('inpPrice').value,
            authStart: document.getElementById('inpAuthStart').value,
            authEnd: document.getElementById('inpAuthEnd').value,
            ref: document.getElementById('inpRef').value,
            phone: document.getElementById('inpPhone').value,
            link: document.getElementById('inpLink').value, 
            desc: document.getElementById('inpDesc').value
        };

        if(!data.district || !data.price) { alert("HATA: ƒ∞l√ße ve Fiyat zorunludur!"); return; }

        if (editingId) {
            const index = portfolio.findIndex(p => p.id === editingId);
            portfolio[index] = data;
        } else {
            portfolio.push(data);
        }
        saveToDisk(); renderTable(); resetForm();
    }

    function editRecord(id) {
        const item = portfolio.find(p => p.id === id); if(!item) return;
        editingId = id;
        document.getElementById('formTitle').innerText = "‚úèÔ∏è D√ºzenleniyor...";
        document.getElementById('btnSave').innerText = "G√úNCELLE"; document.getElementById('btnSave').style.background = "#f39c12"; 
        document.getElementById('btnDelete').style.display = "block"; document.getElementById('btnCancel').style.display = "block";
        
        document.getElementById('inpType').value = item.type; document.getElementById('inpStatus').value = item.status;
        document.getElementById('inpDistrict').value = item.district;
        loadMahalleler('inpDistrict', 'dl_mahalle_ekle');
        setTimeout(() => { document.getElementById('inpNeighborhood').value = item.neighborhood; }, 50);
        document.getElementById('inpRooms').value = item.rooms; document.getElementById('inpFloor').value = item.floor;
        document.getElementById('inpGross').value = item.gross || ''; document.getElementById('inpNet').value = item.net || '';
        document.getElementById('inpPrice').value = item.price;
        document.getElementById('inpAuthStart').value = item.authStart; document.getElementById('inpAuthEnd').value = item.authEnd;
        document.getElementById('inpRef').value = item.ref; document.getElementById('inpPhone').value = item.phone;
        let linkArea = document.getElementById('inpLink'); linkArea.value = item.link || ''; autoResize(linkArea);
        let descArea = document.getElementById('inpDesc'); descArea.value = item.desc || ''; autoResize(descArea);
        window.scrollTo(0,0);
    }

    function deleteFromForm() { if(confirm('Sƒ∞Lƒ∞NECEK!')) { portfolio = portfolio.filter(item => item.id !== editingId); saveToDisk(); renderTable(); resetForm(); } }
    function resetForm() {
        editingId = null;
        document.getElementById('formTitle').innerText = "‚ûï Yeni Portf√∂y Ekle"; document.getElementById('btnSave').innerText = "KAYDET"; document.getElementById('btnSave').style.background = "#27ae60";
        document.getElementById('btnDelete').style.display = "none"; document.getElementById('btnCancel').style.display = "none";
        document.querySelectorAll('.input-panel input, .input-panel select, .input-panel textarea').forEach(i => i.value = '');
        document.querySelectorAll('textarea.auto-expand').forEach(t => t.style.height = 'auto');
        document.getElementById('inpType').value = "Daire"; document.getElementById('inpStatus').value = "Satƒ±lƒ±k";
    }

    function saveToDisk() { localStorage.setItem('KaracabayRE_EST_DB_v13', JSON.stringify(portfolio)); }
    function downloadData() {
        const content = JSON.stringify(portfolio, null, 4);
        const a = document.createElement('a'); a.href = "data:text/plain;charset=utf-8," + encodeURIComponent(content);
        a.download = "Karacabay_Yedek_" + new Date().toISOString().slice(0,10) + ".tkt"; document.body.appendChild(a); a.click(); a.remove();
    }
    function uploadData(input) {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader(); reader.onload = function(e) {
            try { if(confirm("Yedek y√ºklensin mi?")) { portfolio = JSON.parse(e.target.result); saveToDisk(); renderTable(); alert("Y√ºklendi!"); } } catch(err) { alert("Hata!"); }
        }; reader.readAsText(file);
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody'); tbody.innerHTML = '';
        const term = document.getElementById('searchBox').value.toLowerCase();
        const fStatus = document.getElementById('filterStatus').value; const fRoom = document.getElementById('filterRooms').value; 
        const fDist = document.getElementById('filterDistrict').value; const fNeigh = document.getElementById('filterNeighborhood').value.toLowerCase();
        const minP = parsePrice(document.getElementById('filterMinPrice').value); const maxP = parsePrice(document.getElementById('filterMaxPrice').value);

        const filtered = portfolio.filter(item => {
            const txt = (item.district + item.neighborhood + item.ref + item.phone + item.desc + item.type).toLowerCase();
            const p = parsePrice(item.price);
            return txt.includes(term) && ((fRoom === 'all') || (item.rooms === fRoom)) && ((fStatus === 'all') || (item.status === fStatus)) &&
                   (fDist === 'all' || item.district === fDist) && (fNeigh === '' || item.neighborhood.toLowerCase().includes(fNeigh)) &&
                   (minP === 0 || p >= minP) && (maxP === 0 || p <= maxP);
        });

        filtered.forEach(item => {
            let badgeClass = ''; if(item.status.includes('Satƒ±ldƒ±')||item.status.includes('Kiralandƒ±')) badgeClass = 'kirmizi-etiket'; else if(item.status==='Kiralƒ±k') badgeClass = 'kiralik'; else badgeClass = 'satilik';
            let authHtml = '<span style="color:#ccc;">-</span>';
            if(item.authEnd) {
                const today = new Date().toISOString().split('T')[0];
                const color = item.authEnd < today ? '#c0392b' : '#27ae60';
                authHtml = `<small style="color:#777">B≈ül: ${item.authStart ? item.authStart.split('-').reverse().join('.') : '?'}</small><br><strong style="color:${color}; ${item.authEnd < today ? 'text-decoration:line-through' : ''}">${item.authEnd.split('-').reverse().join('.')}</strong>`;
            }

            let btnLinkHtml = '-';
            if (item.link && item.link.trim() !== "") {
                btnLinkHtml = '';
                item.link.split('\n').forEach(l => {
                    let rawUrl = l.trim();
                    if(rawUrl !== "") {
                        let lowerUrl = rawUrl.toLowerCase();
                        let label = "Web Linki"; let btnColorClass = ""; let isFile = false;
                        
                        if(lowerUrl.includes("sahibinden") || lowerUrl.includes("shbd")) { label = "Sahibinden"; btnColorClass = "link-sahibinden"; }
                        else if(lowerUrl.includes("hepsiemlak")) { label = "HepsiEmlak"; btnColorClass = "link-hepsi"; }
                        else if(lowerUrl.includes("obudur")) { label = "Obudur"; btnColorClass = "link-obudur"; }
                        else if(lowerUrl.includes("emlakjet")) { label = "EmlakJet"; btnColorClass = "link-emlakjet"; }
                        else if(lowerUrl.includes("facebook") || lowerUrl.includes("instagram")) { label = "Sosyal Medya"; btnColorClass = "link-sosyal"; }
                        else if(lowerUrl.includes("‚ñ∏") || lowerUrl.includes("icloud") || lowerUrl.startsWith("/") || lowerUrl.startsWith("\\\\") || /^[a-z]:/i.test(rawUrl) || rawUrl.includes("\\") || /\.(pdf|docx?|xlsx?|txt|jpe?g|png)$/i.test(rawUrl)) {
                            label = "Dosya"; btnColorClass = "link-dosya"; isFile = true;
                        }

                        let finalHref = rawUrl;
                        if(!isFile && !finalHref.startsWith('http') && !finalHref.startsWith('//')) finalHref = 'https://' + finalHref;
                        
                        if(isFile) btnLinkHtml += `<button onclick="alert('Dosya Yolu:\\n${rawUrl.replace(/\\/g,'\\\\')}')" class="direct-link-btn ${btnColorClass} no-print" style="border:none; cursor:pointer;">${label}</button><br>`;
                        else btnLinkHtml += `<a href="${finalHref}" target="_blank" class="direct-link-btn ${btnColorClass} no-print">${label}</a><br>`;
                    }
                });
            }

            let btnDesc = item.desc ? `<button onclick="document.getElementById('modalText').innerText='${item.desc.replace(/\n/g,'\\n').replace(/'/g, "\\'")}'; document.getElementById('descModal').style.display='block';" class="btn-icon no-print" style="background:#9b59b6; border:none; color:white; border-radius:3px; cursor:pointer; width:100%;">üìù</button>` : '-';
            let m2Display = (item.gross || '-') + ' / ' + (item.net || '-') + ' m¬≤';

            tbody.innerHTML += `<tr>
                <td><span class="badge ${badgeClass}">${item.status}</span><br><small>${item.type}</small></td>
                <td><b>${item.district}</b><br><small>${item.neighborhood}</small></td>
                <td>${item.rooms || ''}<br><small>${item.floor || ''}</small></td>
                <td style="font-size:12px; font-weight:600; color:#555;">${m2Display}</td>
                <td style="color:#27ae60; font-weight:bold;">${item.price} ‚Ç∫</td>
                <td>${item.ref}<br><small style="font-family:monospace; font-weight:bold;">${item.phone || ''}</small></td>
                <td>${authHtml}</td>
                <td class="no-print" style="text-align:center;">${btnLinkHtml}</td>
                <td class="no-print" style="text-align:center;">${btnDesc}</td>
                <td class="no-print"><button onclick="editRecord(${item.id})" style="background:#3498db; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">D√úZENLE</button></td>
                <td class="print-only" style="vertical-align:top;">${item.desc || '-'}</td>
            </tr>`;
        });
    }

    function populateSelects() {
        const dS = document.getElementById('inpDistrict'); const fS = document.getElementById('filterDistrict');
        Object.keys(antalyaData).sort().forEach(d => { dS.innerHTML += `<option>${d}</option>`; fS.innerHTML += `<option>${d}</option>`; });
        const rS = document.getElementById('inpRooms'); const rF = document.getElementById('filterRooms');
        roomList.forEach(r => { rS.innerHTML += `<option>${r}</option>`; rF.innerHTML += `<option>${r}</option>`; });
        const flS = document.getElementById('inpFloor'); floorList.forEach(f => flS.innerHTML += `<option>${f}</option>`);
    }

    function loadMahalleler(src, trgId) {
        const val = document.getElementById(src).value; const dataList = document.getElementById(trgId); dataList.innerHTML = '';
        if(antalyaData[val]) { antalyaData[val].sort().forEach(m => { let opt = document.createElement('option'); opt.value = m; dataList.appendChild(opt); }); }
        if(src === 'inpDistrict') document.getElementById('inpNeighborhood').value = '';
        if(src === 'filterDistrict') { document.getElementById('filterNeighborhood').value = ''; renderTable(); }
    }
</script>
</body>
</html>
