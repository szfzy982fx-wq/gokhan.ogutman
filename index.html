<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOKHAN OGUTMAN Emlak AsistanÄ± (v18)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #27ae60;
            --danger: #c0392b;
            --sold: #d63031;
            --tool-bg: #f8f9fa;
            --warning-bg: #fff3cd;
            --alert-bg: #f8d7da;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f3; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1800px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .backup-controls { display: flex; gap: 10px; }
        .btn-backup { background: #f39c12; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px; display: flex; align-items: center; gap: 5px; }
        
        /* Toolbar */
        .tools-bar { display: flex; gap: 10px; background: var(--tool-bg); padding: 10px; border-radius: 6px; margin-bottom: 25px; border: 1px solid #ddd; flex-wrap: wrap; align-items: center; }
        .tool-btn { background: white; border: 1px solid #ccc; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 8px; transition: all 0.2s; text-decoration: none; }
        .tool-btn:hover { background: var(--secondary); color: white; border-color: var(--secondary); }
        .dakv-btn { background: #fef9e7; color: #d35400; border-color: #f39c12; } .dakv-btn:hover { background: #d35400; color: white; }
        .crm-btn { background: #ebf5fb; color: #2980b9; border-color: #2980b9; } .crm-btn:hover { background: #2980b9; color: white; }

        /* Form & Inputs */
        .input-panel { background: #fdfdfd; padding: 20px; border: 1px solid #ddd; border-left: 6px solid var(--primary); margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; }
        .form-group label { display: block; font-size: 11px; font-weight: 700; margin-bottom: 5px; color: #555; text-transform: uppercase; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        textarea.auto-expand { overflow-y: hidden; min-height: 40px; resize: none; transition: height 0.1s; }
        .auth-box { grid-column: span 2; display: flex; gap: 15px; background: #eafaf1; padding: 15px; border: 1px dashed var(--accent); border-radius: 6px; }
        .form-buttons { grid-column: span 2; display: flex; gap: 10px; margin-top: 10px; }
        
        /* Buttons */
        .btn-save { background: var(--accent); color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer; font-weight: bold; flex: 2; }
        .btn-save:hover { background: #219150; }
        .btn-delete-rec { background: var(--danger); color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer; font-weight: bold; display: none; }
        .btn-cancel { background: #7f8c8d; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; display: none; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; table-layout: fixed; }
        th { background: #34495e; color: white; padding: 12px; text-align: left; vertical-align: middle; }
        td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: middle; word-wrap: break-word; }
        tr:hover { background: #f9f9f9; }
        .badge { padding: 4px 8px; border-radius: 4px; color: white; font-size: 11px; font-weight: bold; display:inline-block; }
        .satilik { background: var(--secondary); } .kiralik { background: #e67e22; } .kirmizi-etiket { background: var(--sold) !important; }
        
        /* Links */
        .direct-link-btn { display: inline-block; background-color: #3498db; color: white; text-decoration: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; font-weight: 600; }
        .link-sahibinden { background-color: #f1c40f; color: black; } .link-hepsi { background-color: #e74c3c; } .link-obudur { background-color: #8e44ad; } .link-emlakjet { background-color: #2ecc71; } .link-dosya { background-color: #95a5a6; border: 1px solid #7f8c8d; } .link-sosyal { background-color: #d63031; }

        /* Filter */
        .filter-bar { background: var(--primary); padding: 15px; border-radius: 6px; display: flex; gap: 10px; flex-wrap: wrap; color: white; align-items: center; }
        .filter-bar input, .filter-bar select { padding: 8px; border: none; border-radius: 4px; color: #333; }

        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; }
        .modal-content { background: white; margin: 2% auto; padding: 25px; width: 90%; border-radius: 8px; position: relative; max-height: 95vh; display: flex; flex-direction: column; }
        .modal-body { overflow-y: auto; margin-top: 15px; padding-right: 10px; }
        .tool-modal-content { width: 450px; margin: 10% auto; }

        /* CRM Styles & Scroll Fix */
        .crm-header { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; flex-shrink: 0; }
        .crm-tab { padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 6px; border: 1px solid #eee; background: #f9f9f9; }
        .crm-tab.active { background: var(--secondary); color: white; border-color: var(--secondary); }
        .crm-input-panel { background: #f1f2f6; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 5px solid var(--secondary); flex-shrink: 0; }
        .crm-input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; align-items: start; }
        .crm-buttons { display: flex; gap: 10px; margin-top: 15px; justify-content: flex-end; }
        
        /* SCROLLABLE TABLE AREA */
        .table-scroll-wrapper {
            max-height: 450px; /* Listenin gÃ¶rÃ¼neceÄŸi yÃ¼kseklik */
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .crm-table thead th { position: sticky; top: 0; z-index: 1; box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1); }
        
        .row-alert { background-color: var(--alert-bg) !important; color: #721c24; }
        .row-warning { background-color: var(--warning-bg) !important; color: #856404; }
        .crm-status-badge { padding: 3px 6px; border-radius: 4px; font-weight: bold; font-size: 11px; }

        /* Other Tool Styles */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calc-btn { padding: 15px; font-size: 18px; cursor: pointer; background: #eee; border: none; border-radius: 4px; } .calc-btn:hover { background: #ddd; }
        .calc-btn.op { background: var(--secondary); color: white; } .calc-btn.eq { background: var(--accent); color: white; grid-column: span 2; }
        .calc-screen { width: 100%; padding: 10px; font-size: 24px; text-align: right; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .currency-board { display: flex; flex-direction: column; gap: 15px; }
        .currency-row { display: flex; align-items: center; justify-content: space-between; background: #f9f9f9; padding: 10px; border-radius: 6px; border: 1px solid #eee; }
        .result-box { margin-top: 15px; padding: 10px; background: #f0f9ff; border: 1px solid #bce8f1; color: #31708f; font-weight: bold; border-radius: 4px; text-align: center; font-size: 1.1em; }
        .tab-buttons { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: none; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab-btn.active { border-bottom-color: var(--secondary); color: var(--secondary); font-weight: bold; }
        .tab-content { display: none; } .tab-content.active { display: block; }

        .print-only { display: none; }
        @media print { 
            .input-panel, .filter-bar, .backup-controls, .tools-bar { display: none !important; } 
            .no-print { display: none !important; }
            .print-only { display: table-cell !important; }
            body { background: white; padding: 0; margin: 0; }
            table { width: 100%; font-size: 10px; }
            th, td { border: 1px solid #ddd; padding: 4px; color: black; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>ğŸ¢ GOKHAN OGUTMAN <span style="font-size:12px; color:#27ae60; border:1px solid #27ae60; padding:2px 8px; border-radius:10px;">HDD KAYIT AKTÄ°F</span></h1>
        </div>
        <div class="backup-controls">
            <input type="file" id="fileUpload" style="display:none;" onchange="uploadData(this)">
            <button class="btn-backup btn-upload" onclick="document.getElementById('fileUpload').click()">ğŸ“‚ YEDEK YÃœKLE</button>
            <button class="btn-backup" onclick="downloadData()">ğŸ’¾ YEDEKLE</button>
        </div>
    </header>

    <div class="tools-bar">
        <button class="tool-btn crm-btn" onclick="openCRM()"><i class="fa-solid fa-users"></i> MÃ¼ÅŸteri Ä°liÅŸkileri (CRM)</button>
        <button class="tool-btn" onclick="openModal('calcModal')"><i class="fa-solid fa-calculator"></i> Hesap Makinesi</button>
        <button class="tool-btn" onclick="openModal('currencyModal'); fetchCurrency();"><i class="fa-solid fa-money-bill-transfer"></i> DÃ¶viz Ã‡evirici</button>
        <button class="tool-btn" onclick="openModal('realEstateCalcModal')"><i class="fa-solid fa-file-contract"></i> Hesaplamalar</button>
        <a href="https://www.hesapkurdu.com/konut-kredisi/h/gayrimenkul-deger-artis-kazanci-vergisi-hesaplama" target="_blank" class="tool-btn dakv-btn"><i class="fa-solid fa-calculator"></i> DAKV Hesapla</a>
        <a href="https://parselsorgu.tkgm.gov.tr/" target="_blank" class="tool-btn tkgm-btn"><i class="fa-solid fa-map-location-dot"></i> TKGM Parsel Sorgu</a>
    </div>

    <div class="input-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <span id="formTitle" style="font-weight:bold; color:var(--primary); font-size:1.1em;">â• Yeni PortfÃ¶y Ekle</span>
            <button id="btnCancel" class="btn-cancel" onclick="resetForm()">TEMÄ°ZLE / Ä°PTAL</button>
        </div>
        <div class="form-grid">
            <div class="form-group"><label>Menkul Cinsi</label><select id="inpType"><option>Daire</option><option>Villa</option><option>Arsa</option><option>Ä°ÅŸyeri</option><option>Tarla</option><option>Proje</option></select></div>
            <div class="form-group"><label>Ä°ÅŸlem TÃ¼rÃ¼</label><select id="inpStatus"><option>SatÄ±lÄ±k</option><option>KiralÄ±k</option><option>Devren</option><option style="color:red; font-weight:bold;">SatÄ±ldÄ±</option><option style="color:red; font-weight:bold;">KiralandÄ±</option></select></div>
            <div class="form-group"><label>Ä°lÃ§e</label><select id="inpDistrict" onchange="loadMahalleler('inpDistrict', 'dl_mahalle_ekle')"><option value="">SeÃ§iniz</option></select></div>
            <div class="form-group"><label>Mahalle</label><input type="text" list="dl_mahalle_ekle" id="inpNeighborhood" placeholder="YazÄ±nÄ±z..." autocomplete="off"><datalist id="dl_mahalle_ekle"></datalist></div>
            <div class="form-group"><label>Oda</label><select id="inpRooms"></select></div>
            <div class="form-group"><label>Kat</label><select id="inpFloor"></select></div>
            <div class="form-group"><label>BrÃ¼t mÂ²</label><input type="number" id="inpGross" placeholder="mÂ²"></div>
            <div class="form-group"><label>Net mÂ²</label><input type="number" id="inpNet" placeholder="mÂ²"></div>
            <div class="form-group"><label>Fiyat (TL)</label><input type="text" id="inpPrice" placeholder="5.000.000" oninput="formatCurrency(this)"></div>
            <div class="auth-box">
                <div class="form-group" style="flex:1;"><label>Yetki BaÅŸlangÄ±Ã§</label><input type="date" id="inpAuthStart"></div>
                <div class="form-group" style="flex:1;"><label>Yetki BitiÅŸ</label><input type="date" id="inpAuthEnd"></div>
            </div>
            <div class="form-group"><label>MÃ¼ÅŸteri Ad Soyad</label><input type="text" id="inpRef"></div>
            <div class="form-group"><label>MÃ¼ÅŸteri Telefon</label><input type="text" id="inpPhone" placeholder="05XX..." maxlength="17" oninput="formatPhone(this)"></div>
            <div class="form-group"><label>Dosya / Link</label><textarea id="inpLink" placeholder="Link veya Dosya Yolu..." rows="1" class="auto-expand" oninput="autoResize(this)"></textarea></div>
            <div class="form-group" style="grid-column:span 2;"><label>AÃ§Ä±klama</label><textarea id="inpDesc" class="auto-expand" placeholder="DetaylÄ± aÃ§Ä±klama..." oninput="autoResize(this)"></textarea></div>
            <div class="form-buttons">
                <button id="btnSave" class="btn-save" onclick="handleSave()">KAYDET</button>
                <button id="btnDelete" class="btn-delete-rec" onclick="deleteFromForm()">ğŸ—‘ï¸ SÄ°L</button>
            </div>
        </div>
    </div>

    <div class="filter-bar">
        <span>ğŸ” ARA:</span> <input type="text" id="searchBox" placeholder="Ä°sim, Tel, Not..." onkeyup="renderTable()" style="width:140px;">
        <select id="filterStatus" onchange="renderTable()" style="width:110px;"><option value="all">TÃ¼m Durumlar</option><option>SatÄ±lÄ±k</option><option>KiralÄ±k</option><option>Devren</option><option style="color:red;">SatÄ±ldÄ±</option><option style="color:red;">KiralandÄ±</option></select>
        <select id="filterRooms" onchange="renderTable()" style="width:120px;"><option value="all">TÃ¼m Odalar</option></select>
        <select id="filterDistrict" onchange="loadMahalleler('filterDistrict', 'dl_mahalle_filtre')"><option value="all">TÃ¼m Ä°lÃ§eler</option></select>
        <input type="text" list="dl_mahalle_filtre" id="filterNeighborhood" placeholder="Mahalle Ara..." onkeyup="renderTable()" style="width:120px;" autocomplete="off"><datalist id="dl_mahalle_filtre"></datalist>
        <input type="number" id="filterMinPrice" placeholder="Min TL" onkeyup="renderTable()" style="width:80px;"> <input type="number" id="filterMaxPrice" placeholder="Max TL" onkeyup="renderTable()" style="width:80px;">
        <button onclick="window.print()" style="margin-left:auto; background:#8e44ad; border:none; color:white; padding:8px 15px; border-radius:4px; cursor:pointer;">ğŸ–¨ï¸ YAZDIR</button>
    </div>
    <table id="portfolioTable"><thead><tr><th width="8%">Cins/TÃ¼r</th><th width="12%">Lokasyon</th><th width="8%">Ã–zellikler</th><th width="10%">mÂ² (BrÃ¼t/Net)</th><th width="9%">Fiyat</th><th width="14%">MÃ¼ÅŸteri / Tel</th><th width="9%">Yetki</th><th class="no-print" width="6%" style="text-align:center;">Linkler</th><th class="no-print" width="5%" style="text-align:center;">Not</th><th class="no-print" width="8%">Ä°ÅŸlem</th><th class="print-only">AÃ§Ä±klama / Notlar</th></tr></thead><tbody id="tableBody"></tbody></table>
</div>

<div id="crmModal" class="modal" onclick="closeModalOutside(event, 'crmModal')">
    <div class="modal-content">
        <div style="display:flex;justify-content:space-between; margin-bottom:10px;"><h3>ğŸ‘¥ MÃ¼ÅŸteri Ä°liÅŸkileri (CRM)</h3><span onclick="closeModal('crmModal')" style="cursor:pointer;font-size:24px;">&times;</span></div>
        
        <div class="crm-header">
            <div id="tab1" class="crm-tab active" onclick="switchCRMTab('investors')">ğŸ’° Talep Havuzu</div>
            <div id="tab2" class="crm-tab" onclick="switchCRMTab('network')">ğŸ“¢ Etki Ã‡evresi</div>
        </div>

        <div id="crmInvestors" class="crm-section" style="display:block;">
            <div class="crm-input-panel">
                <div class="crm-input-grid">
                    <div class="form-group"><label>Ad Soyad</label><input type="text" id="invName"></div>
                    <div class="form-group"><label>Åehir</label><input type="text" id="invCity" value="Antalya"></div>
                    <div class="form-group"><label>Telefon (Alt alta Ã§oklu)</label><textarea id="invPhone" rows="2" class="auto-expand" placeholder="+(90) (XXX) XXX XX XX" oninput="formatPhoneMulti(this)"></textarea></div>
                    <div class="form-group"><label>Talep</label><textarea id="invRequest" rows="2" class="auto-expand" placeholder="Detaylar..."></textarea></div>
                </div>
                <div class="crm-buttons">
                    <button id="btnInvSave" class="btn-save" style="flex:0; width:120px;" onclick="saveCRMInvestor()">EKLE</button>
                    <button id="btnInvDelete" class="btn-delete-rec" style="flex:0; width:100px; display:none;" onclick="deleteCRMInvestor()">SÄ°L</button>
                    <button id="btnInvCancel" class="btn-cancel" style="flex:0; display:none;" onclick="resetCRMForm('investors')">Ä°PTAL</button>
                </div>
            </div>
            <div class="table-scroll-wrapper">
                <table class="crm-table">
                    <thead><tr><th>Ad Soyad</th><th>Åehir</th><th>Telefon</th><th>Talep DetayÄ±</th><th width="80">Ä°ÅŸlem</th></tr></thead>
                    <tbody id="investorTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="crmNetwork" class="crm-section" style="display:none;">
            <div style="background:#eafaf1; padding:10px; margin-bottom:15px; border-radius:4px; border:1px solid #27ae60; color:#27ae60; font-size:13px; flex-shrink:0;">
                â„¹ï¸ <b>Bilgi:</b> KiÅŸiyi dÃ¼zenlemek iÃ§in listedeki "DÃœZENLE" butonuna basÄ±nÄ±z. Ekleme ve silme iÅŸlemi yukarÄ±daki formdan yapÄ±lÄ±r.
            </div>
            <div class="crm-input-panel">
                <div class="crm-input-grid">
                    <div class="form-group"><label>Ad Soyad</label><input type="text" id="netName"></div>
                    <div class="form-group"><label>Åehir</label><input type="text" id="netCity" value="Antalya"></div>
                    <div class="form-group"><label>Telefon (Alt alta Ã§oklu)</label><textarea id="netPhone" rows="2" class="auto-expand" placeholder="+(90) (XXX) XXX XX XX" oninput="formatPhoneMulti(this)"></textarea></div>
                    <div class="form-group"><label>Arz TÃ¼rÃ¼ / Potansiyel</label><textarea id="netSupply" rows="2" class="auto-expand" placeholder="Ã–rn: Site YÃ¶neticisi"></textarea></div>
                    <div class="form-group"><label>Son Arama</label><input type="date" id="netLastCall"></div>
                </div>
                <div class="crm-buttons">
                    <button id="btnNetSave" class="btn-save" style="flex:0; width:120px;" onclick="saveCRMNetwork()">EKLE</button>
                    <button id="btnNetDelete" class="btn-delete-rec" style="flex:0; width:100px; display:none;" onclick="deleteCRMNetwork()">SÄ°L</button>
                    <button id="btnNetCancel" class="btn-cancel" style="flex:0; display:none;" onclick="resetCRMForm('network')">Ä°PTAL</button>
                </div>
            </div>
            <div class="table-scroll-wrapper">
                <table class="crm-table">
                    <thead><tr><th>Durum</th><th>Ad Soyad</th><th>Åehir</th><th>Telefon</th><th>Arz / Potansiyel</th><th>Son Arama</th><th width="120">Takip</th><th width="80">Ä°ÅŸlem</th></tr></thead>
                    <tbody id="networkTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="descModal" class="modal" onclick="closeModalOutside(event, 'descModal')"><div class="modal-content"><div style="display:flex;justify-content:space-between;"><h3>ğŸ“ Notlar</h3><span onclick="closeModal('descModal')" style="cursor:pointer;">&times;</span></div><p id="modalText" style="white-space: pre-wrap; margin-top:10px;"></p></div></div>
<div id="calcModal" class="modal" onclick="closeModalOutside(event, 'calcModal')"><div class="modal-content tool-modal-content"><div style="display:flex;justify-content:space-between;margin-bottom:10px;"><h3>ğŸ§® Hesap Makinesi</h3><span onclick="closeModal('calcModal')" style="cursor:pointer;font-size:24px;">&times;</span></div><input type="text" id="calcDisplay" class="calc-screen" readonly><div class="calc-grid"><button class="calc-btn" onclick="calcInput('7')">7</button><button class="calc-btn" onclick="calcInput('8')">8</button><button class="calc-btn" onclick="calcInput('9')">9</button><button class="calc-btn op" onclick="calcInput('/')">Ã·</button><button class="calc-btn" onclick="calcInput('4')">4</button><button class="calc-btn" onclick="calcInput('5')">5</button><button class="calc-btn" onclick="calcInput('6')">6</button><button class="calc-btn op" onclick="calcInput('*')">Ã—</button><button class="calc-btn" onclick="calcInput('1')">1</button><button class="calc-btn" onclick="calcInput('2')">2</button><button class="calc-btn" onclick="calcInput('3')">3</button><button class="calc-btn op" onclick="calcInput('-')">-</button><button class="calc-btn" onclick="calcInput('0')">0</button><button class="calc-btn" onclick="calcInput('.')">.</button><button class="calc-btn" onclick="calcClear()">C</button><button class="calc-btn op" onclick="calcInput('+')">+</button><button class="calc-btn eq" onclick="calcResult()">=</button></div></div></div>
<div id="currencyModal" class="modal" onclick="closeModalOutside(event, 'currencyModal')"><div class="modal-content tool-modal-content"><div style="display:flex;justify-content:space-between; margin-bottom:15px;"><h3>ğŸ’± DÃ¶viz (Efektif SatÄ±ÅŸ)</h3><span onclick="closeModal('currencyModal')" style="cursor:pointer;font-size:24px;">&times;</span></div><div style="margin-bottom:15px;"><a href="https://www.tcmb.gov.tr/wps/wcm/connect/tr/tcmb+tr/main+page+site+area/bugun" target="_blank" class="tool-btn tkgm-btn" style="width:100%; justify-content:center; text-align:center;"> TCMB KurlarÄ±nÄ± AÃ§ </a><div style="font-size:11px; color:#666; margin-top:5px; text-align:center;">*Otomatik deÄŸerler piyasa verisidir. Kesin iÅŸlem iÃ§in TCMB sayfasÄ±ndaki "Efektif SatÄ±ÅŸ" sÃ¼tununa bakÄ±nÄ±z.</div></div><div class="currency-board"><div class="currency-row"><span class="curr-flag">ğŸ‡ºğŸ‡¸</span><span class="curr-name">USD / TRY</span><div><div class="curr-label">Efektif SatÄ±ÅŸ</div><input type="number" id="usdRate" class="curr-input" placeholder="36.00"></div></div><div class="currency-row"><span class="curr-flag">ğŸ‡ªğŸ‡º</span><span class="curr-name">EUR / TRY</span><div><div class="curr-label">Efektif SatÄ±ÅŸ</div><input type="number" id="eurRate" class="curr-input" placeholder="38.00"></div></div></div><hr style="margin:15px 0; border:0; border-top:1px solid #eee;"><div class="form-group"><label>Ã‡evrilecek Tutar</label><div style="display:flex; gap:10px;"><input type="number" id="calcCurrAmount" placeholder="1000" style="flex:2;"><select id="calcCurrType" style="flex:1;"><option value="USD">USD</option><option value="EUR">EUR</option></select></div></div><button class="btn-save" style="width:100%; margin-top:10px;" onclick="calculateCurrencyTotal()">HESAPLA (TL)</button><div id="currencyTotalRes" class="currency-result" style="display:none;"><span id="currResText" style="font-size:1.4em; font-weight:bold; color:#2c3e50;">0,00 TL</span></div></div></div>
<div id="realEstateCalcModal" class="modal" onclick="closeModalOutside(event, 'realEstateCalcModal')"><div class="modal-content" style="width:500px;"><div style="display:flex;justify-content:space-between; margin-bottom:10px;"><h3>ğŸ§¾ Emlak HesaplamalarÄ±</h3><span onclick="closeModal('realEstateCalcModal')" style="cursor:pointer;font-size:24px;">&times;</span></div><div class="tab-buttons"><button class="tab-btn active" onclick="switchTab('tabTapu')">Tapu & Komisyon</button><button class="tab-btn" onclick="switchTab('tabEmsal')">Emsal</button><button class="tab-btn" onclick="switchTab('tabVergi')">Emlak Vergisi</button></div><div id="tabTapu" class="tab-content active"><div class="form-group"><label>SatÄ±ÅŸ Bedeli (TL)</label><input type="number" id="calcPrice" placeholder="Ã–rn: 5000000"></div><button class="btn-save" style="width:100%; margin-top:10px;" onclick="calcTapuKomisyon()">HESAPLA</button><div id="resTapu" class="result-box" style="display:none; text-align:left; font-size:13px;"></div></div><div id="tabEmsal" class="tab-content"><div class="form-group"><label>Arsa AlanÄ± (mÂ²)</label><input type="number" id="calcArsaM2"></div><div class="form-group"><label>KAKS / Emsal OranÄ±</label><input type="number" id="calcKaks" placeholder="Ã–rn: 1.5"></div><button class="btn-save" style="width:100%; margin-top:10px;" onclick="calcEmsal()">HESAPLA</button><div id="resEmsal" class="result-box" style="display:none;"></div></div><div id="tabVergi" class="tab-content"><div class="form-group"><label>Emlak Vergisi Hesapla</label></div><div style="display:flex; gap:10px;"><select id="calcVergiType" style="flex:1;"><option value="0.002">Konut (B.Åehir - %0.2)</option><option value="0.001">Konut (Normal - %0.1)</option><option value="0.004">Ä°ÅŸyeri (B.Åehir - %0.4)</option><option value="0.002">Ä°ÅŸyeri (Normal - %0.2)</option><option value="0.006">Arsa (B.Åehir - %0.6)</option></select><input type="number" id="calcVergiDeger" placeholder="RayiÃ§ Bedel" style="flex:1;"></div><button class="btn-save" style="width:100%; margin-top:5px;" onclick="calcEmlakVergisi()">VERGÄ° HESAPLA</button><div id="resVergi" class="result-box" style="display:none; margin-bottom:15px;"></div></div></div></div>

<script>
    const antalyaData = { "Akseki": ["Merkez"], "Aksu": ["AltÄ±ntaÅŸ","AtatÃ¼rk","GÃ¼zelyurt","Kundu","Macun"], "Alanya": ["Merkez","Avsallar","Mahmutlar","Oba"], "DÃ¶ÅŸemealtÄ±": ["AltÄ±nkale","BahÃ§eyaka","YenikÃ¶y","YeÅŸilbayÄ±r"], "Kepez": ["AtatÃ¼rk","BarÄ±ÅŸ","GÃ¼lveren","KÃ¼ltÃ¼r","SÃ¼tÃ§Ã¼ler","Varsak","Yeni"], "KonyaaltÄ±": ["AltÄ±nkum","GÃ¼rsu","Hurma","Liman","Molla Yusuf","UncalÄ±"], "MuratpaÅŸa": ["BahÃ§elievler","Ã‡aÄŸlayan","Fener","GÃ¼zeloba","KÄ±rcami","Lara","Meltem","ÅirinyalÄ±"], "Serik": ["Belek","BoÄŸazkent","Kadriye","Merkez"] };
    const floorList = ["GiriÅŸ", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "Dubleks", "Tripleks"];
    const roomList = ["1+1", "2+1", "3+1", "4+1", "5+1", "Villa", "Ä°ÅŸyeri"];
    
    // DB - VeritabanÄ± (v17 ile aynÄ± devam ediyor)
    let crmData = JSON.parse(localStorage.getItem('GokhanOgutman_CRM_v17')) || { investors: [], network: [] };
    let portfolio = JSON.parse(localStorage.getItem('GokhanOgutman_EST_DB_v17')) || [];
    let editingId = null;
    let crmEditingId = null;

    window.onload = function() { populateSelects(); renderTable(); };

    // --- HELPER FUNCTIONS ---
    function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
    function formatPhone(input) { let n = input.value.replace(/\D/g, ''); if(n.length===0){input.value='';return;} if(n[0]!=='0') n='0'+n; n=n.substring(0,11); input.value = n; }
    function formatPhoneMulti(input) {
        let lines = input.value.split('\n');
        let formattedLines = lines.map(line => {
            let n = line.replace(/\D/g, ''); if(n.length === 0) return line; if(n[0] !== '0') n = '0' + n; n = n.substring(0, 11);
            let f = ''; if(n.length > 0) f += n.substring(0, 1); if(n.length > 1) f += ' (' + n.substring(1, 4); if(n.length > 4) f += ') ' + n.substring(4, 7); if(n.length > 7) f += ' ' + n.substring(7, 9); if(n.length > 9) f += ' ' + n.substring(9, 11);
            return f;
        });
        let newVal = formattedLines.join('\n'); if(input.value !== newVal) { input.value = newVal; }
    }
    function formatCurrency(input) { let v=input.value.replace(/\D/g, ''); input.value=v.replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
    function parsePrice(v) { return v ? parseInt(v.toString().replace(/\./g,'')) : 0; }
    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function closeModalOutside(e, id) { if(e.target == document.getElementById(id)) closeModal(id); }

    // --- CRM LOGIC ---
    function openCRM() {
        document.getElementById('crmModal').style.display = 'block';
        renderInvestors();
        renderNetwork();
        document.getElementById('netLastCall').valueAsDate = new Date();
    }

    function switchCRMTab(tab) {
        document.querySelectorAll('.crm-section').forEach(s => s.style.display = 'none');
        document.querySelectorAll('.crm-tab').forEach(t => t.classList.remove('active'));
        if(tab === 'investors') { document.getElementById('crmInvestors').style.display = 'block'; document.getElementById('tab1').classList.add('active'); } 
        else { document.getElementById('crmNetwork').style.display = 'block'; document.getElementById('tab2').classList.add('active'); }
        resetCRMForm('investors'); resetCRMForm('network');
    }

    function saveCRMInvestor() {
        const inv = { id: crmEditingId ? crmEditingId : Date.now(), name: document.getElementById('invName').value, city: document.getElementById('invCity').value, phone: document.getElementById('invPhone').value, req: document.getElementById('invRequest').value };
        if(!inv.name) { alert("Ad Soyad giriniz."); return; }
        if(crmEditingId) { crmData.investors[crmData.investors.findIndex(i => i.id === crmEditingId)] = inv; } else { crmData.investors.push(inv); }
        saveCRM(); renderInvestors(); resetCRMForm('investors');
    }
    function editCRMInvestor(id) {
        const item = crmData.investors.find(i => i.id === id); if(!item) return; crmEditingId = id;
        document.getElementById('invName').value = item.name; document.getElementById('invCity').value = item.city; document.getElementById('invPhone').value = item.phone; autoResize(document.getElementById('invPhone')); document.getElementById('invRequest').value = item.req; autoResize(document.getElementById('invRequest'));
        document.getElementById('btnInvSave').innerText = "GÃœNCELLE"; document.getElementById('btnInvSave').style.background = "#f39c12"; document.getElementById('btnInvDelete').style.display = "block"; document.getElementById('btnInvCancel').style.display = "block";
    }
    function deleteCRMInvestor() { if(confirm('Silinsin mi?')) { crmData.investors = crmData.investors.filter(i => i.id !== crmEditingId); saveCRM(); renderInvestors(); resetCRMForm('investors'); } }

    function saveCRMNetwork() {
        const net = { id: crmEditingId ? crmEditingId : Date.now(), name: document.getElementById('netName').value, city: document.getElementById('netCity').value, phone: document.getElementById('netPhone').value, supply: document.getElementById('netSupply').value, lastCall: document.getElementById('netLastCall').value };
        if(!net.name) { alert("Ad Soyad giriniz."); return; }
        if(crmEditingId) { crmData.network[crmData.network.findIndex(n => n.id === crmEditingId)] = net; } else { crmData.network.push(net); }
        saveCRM(); renderNetwork(); resetCRMForm('network');
    }
    function editCRMNetwork(id) {
        const item = crmData.network.find(n => n.id === id); if(!item) return; crmEditingId = id;
        document.getElementById('netName').value = item.name; document.getElementById('netCity').value = item.city; document.getElementById('netPhone').value = item.phone; autoResize(document.getElementById('netPhone')); document.getElementById('netSupply').value = item.supply; autoResize(document.getElementById('netSupply')); document.getElementById('netLastCall').value = item.lastCall;
        document.getElementById('btnNetSave').innerText = "GÃœNCELLE"; document.getElementById('btnNetSave').style.background = "#f39c12"; document.getElementById('btnNetDelete').style.display = "block"; document.getElementById('btnNetCancel').style.display = "block";
    }
    function deleteCRMNetwork() { if(confirm('Silinsin mi?')) { crmData.network = crmData.network.filter(n => n.id !== crmEditingId); saveCRM(); renderNetwork(); resetCRMForm('network'); } }

    function resetCRMForm(type) {
        crmEditingId = null;
        if(type === 'investors') {
            document.getElementById('invName').value = ''; document.getElementById('invPhone').value = ''; document.getElementById('invRequest').value = '';
            document.getElementById('btnInvSave').innerText = "EKLE"; document.getElementById('btnInvSave').style.background = "#27ae60"; document.getElementById('btnInvDelete').style.display = "none"; document.getElementById('btnInvCancel').style.display = "none";
        } else {
            document.getElementById('netName').value = ''; document.getElementById('netPhone').value = ''; document.getElementById('netSupply').value = ''; document.getElementById('netLastCall').valueAsDate = new Date();
            document.getElementById('btnNetSave').innerText = "EKLE"; document.getElementById('btnNetSave').style.background = "#27ae60"; document.getElementById('btnNetDelete').style.display = "none"; document.getElementById('btnNetCancel').style.display = "none";
        }
    }
    function renderInvestors() { const tbody = document.getElementById('investorTableBody'); tbody.innerHTML = ''; crmData.investors.forEach(inv => { tbody.innerHTML += `<tr><td><b>${inv.name}</b></td><td>${inv.city}</td><td style="white-space:pre-wrap;">${inv.phone}</td><td style="white-space:pre-wrap;">${inv.req}</td><td><button onclick="editCRMInvestor(${inv.id})" style="background:#3498db;color:white;border:none;border-radius:3px;padding:4px 8px;cursor:pointer;">DÃœZENLE</button></td></tr>`; }); }
    function renderNetwork() {
        const tbody = document.getElementById('networkTableBody'); tbody.innerHTML = ''; const today = new Date();
        crmData.network.forEach(net => {
            let statusHtml = '<span class="crm-status-badge" style="background:#eee; color:#333;">Yeni</span>'; let rowClass = '';
            if(net.lastCall) { const lastDate = new Date(net.lastCall); const diffTime = Math.abs(today - lastDate); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                if(diffDays > 45) { rowClass = 'row-alert'; statusHtml = `<span class="crm-status-badge" style="background:white; color:#c0392b;">âš ï¸ ${diffDays} GÃ¼n!</span>`; } 
                else if (diffDays > 30) { rowClass = 'row-warning'; statusHtml = `<span class="crm-status-badge" style="background:white; color:#e67e22;">â³ ${diffDays} GÃ¼n</span>`; } 
                else { statusHtml = `<span class="crm-status-badge" style="background:#27ae60; color:white;">âœ… ${diffDays} GÃ¼n</span>`; }
            }
            tbody.innerHTML += `<tr class="${rowClass}"><td>${statusHtml}</td><td><b>${net.name}</b></td><td>${net.city}</td><td style="white-space:pre-wrap;">${net.phone}</td><td style="white-space:pre-wrap;">${net.supply}</td><td>${net.lastCall ? net.lastCall.split('-').reverse().join('.') : '-'}</td><td><button onclick="updateCallDate(${net.id})" style="background:#2980b9; color:white; border:none; padding:5px; border-radius:3px; cursor:pointer; font-size:11px;">âœ… GÃ¶rÃ¼ÅŸtÃ¼m (SÄ±fÄ±rla)</button></td><td><button onclick="editCRMNetwork(${net.id})" style="background:#3498db; color:white; border:none; padding:4px 8px; border-radius:3px; cursor:pointer;">DÃœZENLE</button></td></tr>`;
        });
    }
    function updateCallDate(id) { const idx = crmData.network.findIndex(n => n.id === id); if(idx !== -1) { crmData.network[idx].lastCall = new Date().toISOString().split('T')[0]; saveCRM(); renderNetwork(); } }
    function saveCRM() { localStorage.setItem('GokhanOgutman_CRM_v17', JSON.stringify(crmData)); }

    // --- OTHER TOOLS LOGIC ---
    let calcExp = "";
    function calcInput(v) { calcExp += v; document.getElementById('calcDisplay').value = calcExp; }
    function calcClear() { calcExp = ""; document.getElementById('calcDisplay').value = ""; }
    function calcResult() { try { calcExp = eval(calcExp).toString(); document.getElementById('calcDisplay').value = calcExp; } catch(e) { document.getElementById('calcDisplay').value = "Hata"; calcExp=""; } }
    async function fetchCurrency() { try { const res = await fetch('https://api.exchangerate-api.com/v4/latest/TRY'); const data = await res.json(); if(document.getElementById('usdRate').value === "") document.getElementById('usdRate').value = (1 / data.rates.USD).toFixed(4); if(document.getElementById('eurRate').value === "") document.getElementById('eurRate').value = (1 / data.rates.EUR).toFixed(4); } catch(e) {} }
    function calculateCurrencyTotal() { let amount = parseFloat(document.getElementById('calcCurrAmount').value); let type = document.getElementById('calcCurrType').value; let rate = type === 'USD' ? parseFloat(document.getElementById('usdRate').value) : parseFloat(document.getElementById('eurRate').value); if(!amount || !rate) return; document.getElementById('currResText').innerText = (amount * rate).toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " TL"; document.getElementById('currencyTotalRes').style.display = 'block'; }
    function switchTab(id) { document.querySelectorAll('.tab-content').forEach(d => d.style.display='none'); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.getElementById(id).style.display = 'block'; event.currentTarget.classList.add('active'); }
    function calcTapuKomisyon() { let p = parseFloat(document.getElementById('calcPrice').value); if(!p) return; let tapu = p * 0.04; let kom = p * 0.02 * 1.20; document.getElementById('resTapu').innerHTML = `<strong>Tapu HarcÄ± (%4):</strong> ${tapu.toLocaleString()} TL<br><strong>Komisyon (%2+KDV):</strong> ${kom.toLocaleString()} TL`; document.getElementById('resTapu').style.display = 'block'; }
    function calcEmsal() { let m2 = parseFloat(document.getElementById('calcArsaM2').value); let kaks = parseFloat(document.getElementById('calcKaks').value); if(!m2 || !kaks) return; document.getElementById('resEmsal').innerHTML = `Ä°nÅŸaat AlanÄ±: <strong>${(m2*kaks).toLocaleString()} mÂ²</strong>`; document.getElementById('resEmsal').style.display = 'block'; }
    function calcEmlakVergisi() { let val = parseFloat(document.getElementById('calcVergiDeger').value); let rate = parseFloat(document.getElementById('calcVergiType').value); if(!val) return; document.getElementById('resVergi').innerHTML = `Vergi: <strong>${(val*rate).toLocaleString()} TL</strong>`; document.getElementById('resVergi').style.display = 'block'; }

    // --- MAIN PORTFOLIO CRUD ---
    function handleSave() {
        const data = { id: editingId ? editingId : Date.now(), type: document.getElementById('inpType').value, status: document.getElementById('inpStatus').value, district: document.getElementById('inpDistrict').value, neighborhood: document.getElementById('inpNeighborhood').value, rooms: document.getElementById('inpRooms').value, floor: document.getElementById('inpFloor').value, gross: document.getElementById('inpGross').value, net: document.getElementById('inpNet').value, price: document.getElementById('inpPrice').value, authStart: document.getElementById('inpAuthStart').value, authEnd: document.getElementById('inpAuthEnd').value, ref: document.getElementById('inpRef').value, phone: document.getElementById('inpPhone').value, link: document.getElementById('inpLink').value, desc: document.getElementById('inpDesc').value };
        if(!data.district || !data.price) { alert("Ä°lÃ§e ve Fiyat zorunlu!"); return; }
        if (editingId) { portfolio[portfolio.findIndex(p => p.id === editingId)] = data; } else { portfolio.push(data); }
        saveToDisk(); renderTable(); resetForm();
    }
    function editRecord(id) {
        const item = portfolio.find(p => p.id === id); if(!item) return; editingId = id;
        document.getElementById('formTitle').innerText = "âœï¸ DÃ¼zenleniyor..."; document.getElementById('btnSave').innerText = "GÃœNCELLE"; document.getElementById('btnSave').style.background = "#f39c12"; document.getElementById('btnDelete').style.display = "block"; document.getElementById('btnCancel').style.display = "block";
        document.getElementById('inpType').value = item.type; document.getElementById('inpStatus').value = item.status; document.getElementById('inpDistrict').value = item.district;
        loadMahalleler('inpDistrict', 'dl_mahalle_ekle'); setTimeout(() => { document.getElementById('inpNeighborhood').value = item.neighborhood; }, 50);
        document.getElementById('inpRooms').value = item.rooms; document.getElementById('inpFloor').value = item.floor; document.getElementById('inpGross').value = item.gross; document.getElementById('inpNet').value = item.net; document.getElementById('inpPrice').value = item.price; document.getElementById('inpAuthStart').value = item.authStart; document.getElementById('inpAuthEnd').value = item.authEnd; document.getElementById('inpRef').value = item.ref; document.getElementById('inpPhone').value = item.phone; document.getElementById('inpLink').value = item.link; autoResize(document.getElementById('inpLink')); document.getElementById('inpDesc').value = item.desc; autoResize(document.getElementById('inpDesc')); window.scrollTo(0,0);
    }
    function deleteFromForm() { if(confirm('SÄ°LÄ°NECEK!')) { portfolio = portfolio.filter(item => item.id !== editingId); saveToDisk(); renderTable(); resetForm(); } }
    function resetForm() { editingId = null; document.getElementById('formTitle').innerText = "â• Yeni PortfÃ¶y Ekle"; document.getElementById('btnSave').innerText = "KAYDET"; document.getElementById('btnSave').style.background = "#27ae60"; document.getElementById('btnDelete').style.display = "none"; document.getElementById('btnCancel').style.display = "none"; document.querySelectorAll('.input-panel input, .input-panel select, .input-panel textarea').forEach(i => i.value = ''); document.querySelectorAll('textarea.auto-expand').forEach(t => t.style.height = 'auto'); document.getElementById('inpType').value = "Daire"; document.getElementById('inpStatus').value = "SatÄ±lÄ±k"; }
    function saveToDisk() { localStorage.setItem('GokhanOgutman_EST_DB_v17', JSON.stringify(portfolio)); }
    function downloadData() { 
        const fullBackup = { portfolio: portfolio, crm: crmData }; const content = JSON.stringify(fullBackup, null, 4);
        const a = document.createElement('a'); a.href = "data:text/plain;charset=utf-8," + encodeURIComponent(content); a.download = "GokhanOgutman_FULL_Yedek_" + new Date().toISOString().slice(0,10) + ".tkt"; document.body.appendChild(a); a.click(); a.remove(); 
    }
    function uploadData(input) {
        const file = input.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = function(e) {
            try { 
                if(confirm("Yedek yÃ¼klensin mi?")) { 
                    const data = JSON.parse(e.target.result); if(data.portfolio) { portfolio = data.portfolio; crmData = data.crm || { investors: [], network: [] }; } else { portfolio = data; }
                    saveToDisk(); saveCRM(); renderTable(); alert("YÃ¼klendi!"); 
                } 
            } catch(err) { alert("Dosya hatasÄ±!"); }
        }; reader.readAsText(file);
    }
    function renderTable() {
        const tbody = document.getElementById('tableBody'); tbody.innerHTML = ''; const term = document.getElementById('searchBox').value.toLowerCase();
        const fStatus = document.getElementById('filterStatus').value; const fRoom = document.getElementById('filterRooms').value; const fDist = document.getElementById('filterDistrict').value; const fNeigh = document.getElementById('filterNeighborhood').value.toLowerCase(); const minP = parsePrice(document.getElementById('filterMinPrice').value); const maxP = parsePrice(document.getElementById('filterMaxPrice').value);
        const filtered = portfolio.filter(item => { const txt = (item.district + item.neighborhood + item.ref + item.phone + item.desc + item.type).toLowerCase(); const p = parsePrice(item.price); return txt.includes(term) && ((fRoom === 'all') || (item.rooms === fRoom)) && ((fStatus === 'all') || (item.status === fStatus)) && (fDist === 'all' || item.district === fDist) && (fNeigh === '' || item.neighborhood.toLowerCase().includes(fNeigh)) && (minP === 0 || p >= minP) && (maxP === 0 || p <= maxP); });
        filtered.forEach(item => {
            let badgeClass = item.status.includes('SatÄ±ldÄ±')||item.status.includes('KiralandÄ±') ? 'kirmizi-etiket' : (item.status==='KiralÄ±k'?'kiralik':'satilik');
            let authHtml = '-'; if(item.authEnd) { const today = new Date().toISOString().split('T')[0]; authHtml = `<small style="color:#777">BÅŸl: ${item.authStart.split('-').reverse().join('.')}</small><br><strong style="color:${item.authEnd < today ? '#c0392b' : '#27ae60'}">${item.authEnd.split('-').reverse().join('.')}</strong>`; }
            let btnLinkHtml = '-'; if (item.link && item.link.trim() !== "") { btnLinkHtml = ''; item.link.split('\n').forEach(l => { let r = l.trim(); if(r){ let lbl="Web Linki"; let cls=""; let isF=false; if(r.includes("sahibinden")) {lbl="Sahibinden";cls="link-sahibinden";} else if(r.includes("hepsi")) {lbl="HepsiEmlak";cls="link-hepsi";} else if(r.includes("obudur")) {lbl="Obudur";cls="link-obudur";} else if(r.includes("emlakjet")) {lbl="EmlakJet";cls="link-emlakjet";} else if(r.includes("facebook")||r.includes("instagram")){lbl="Sosyal";cls="link-sosyal";} else if(r.includes("â–¸")||r.includes("icloud")||r.startsWith("/")||r.startsWith("\\\\")||/^[a-z]:/i.test(r)||r.includes("\\")||/\.(pdf|docx?|txt|jpg|png)$/i.test(r)){lbl="Dosya";cls="link-dosya";isF=true;} let href=r; if(!isF && !href.startsWith('http')) href='https://'+href; if(isF) btnLinkHtml += `<button onclick="alert('Dosya Yolu:\\n${r.replace(/\\/g,'\\\\')}')" class="direct-link-btn ${cls} no-print" style="border:none;cursor:pointer;">${lbl}</button><br>`; else btnLinkHtml += `<a href="${href}" target="_blank" class="direct-link-btn ${cls} no-print">${lbl}</a><br>`; }}); }
            let btnDesc = item.desc ? `<button onclick="document.getElementById('modalText').innerText='${item.desc.replace(/\n/g,'\\n').replace(/'/g, "\\'")}'; document.getElementById('descModal').style.display='block';" class="btn-icon no-print" style="background:#9b59b6;border:none;color:white;border-radius:3px;cursor:pointer;">ğŸ“</button>` : '-';
            tbody.innerHTML += `<tr><td><span class="badge ${badgeClass}">${item.status}</span><br><small>${item.type}</small></td><td><b>${item.district}</b><br><small>${item.neighborhood}</small></td><td>${item.rooms}<br><small>${item.floor}</small></td><td>${item.gross}/${item.net} mÂ²</td><td style="color:#27ae60;font-weight:bold;">${item.price} â‚º</td><td>${item.ref}<br><small>${item.phone}</small></td><td>${authHtml}</td><td class="no-print" style="text-align:center;">${btnLinkHtml}</td><td class="no-print" style="text-align:center;">${btnDesc}</td><td class="no-print"><button onclick="editRecord(${item.id})" style="background:#3498db;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;">DÃœZENLE</button></td><td class="print-only">${item.desc}</td></tr>`;
        });
    }
    function populateSelects() { const dS=document.getElementById('inpDistrict'), fS=document.getElementById('filterDistrict'); Object.keys(antalyaData).sort().forEach(d=>{dS.innerHTML+=`<option>${d}</option>`;fS.innerHTML+=`<option>${d}</option>`;}); const rS=document.getElementById('inpRooms'), rF=document.getElementById('filterRooms'); roomList.forEach(r=>{rS.innerHTML+=`<option>${r}</option>`;rF.innerHTML+=`<option>${r}</option>`;}); const fL=document.getElementById('inpFloor'); floorList.forEach(f=>fL.innerHTML+=`<option>${f}</option>`); }
    function loadMahalleler(s,t) { const v=document.getElementById(s).value, d=document.getElementById(t); d.innerHTML=''; if(antalyaData[v]) antalyaData[v].sort().forEach(m=>{let o=document.createElement('option');o.value=m;d.appendChild(o);}); if(s==='inpDistrict')document.getElementById('inpNeighborhood').value=''; if(s==='filterDistrict'){document.getElementById('filterNeighborhood').value='';renderTable();} }
</script>
</body>
</html>
